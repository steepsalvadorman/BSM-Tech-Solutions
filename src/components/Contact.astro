---
import "../styles/global.css";

const servicios = [
  "Desarrollo Web",
  "Aplicaciones Móviles",
  "Software a Medida",
  "Consultoría Técnica",
  "Otro",
];
---

<section id="contacto" class="relative overflow-hidden bg-transparent py-24">
  <div class="absolute inset-0 -z-10">
    <div
      class="absolute top-[-10%] left-1/2 h-120 w-120 -translate-x-1/2 rounded-full bg-cyan-400/5 blur-[140px]"
    >
    </div>
  </div>

  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <header class="mx-auto mb-16 max-w-2xl text-center">
      <h2 class="text-sm font-semibold uppercase tracking-widest text-cyan-400">
        Contacto
      </h2>
      <p class="mt-3 text-4xl font-bold tracking-tight text-white sm:text-5xl">
        Hablemos de tu proyecto
      </p>
      <p class="mt-6 text-lg text-slate-400">
        Cuéntame qué necesitas y te responderé con una propuesta clara y
        realista.
      </p>
    </header>

    <form
      id="contact-form"
      class="mx-auto max-w-3xl rounded-3xl bg-slate-900/60 p-8 backdrop-blur-xl ring-1 ring-white/10 md:p-12"
    >
      <input type="hidden" name="access_key" value="TU_ACCESS_KEY_AQUI" />
      <input
        type="hidden"
        name="subject"
        value="Nuevo contacto desde Dai Dev"
      />
      <input type="hidden" name="from_name" value="Dai Dev Portfolio" />
      <input
        type="checkbox"
        name="botcheck"
        class="hidden"
        style="display: none;"
      />

      <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
        <div>
          <label for="name" class="block text-sm font-medium text-slate-300"
            >Nombre completo</label
          >
          <input
            type="text"
            id="name"
            name="name"
            required
            placeholder="Juan Pérez"
            class="mt-2 w-full rounded-xl bg-slate-950 px-4 py-3 text-white placeholder:text-slate-500 ring-1 ring-white/10 focus:ring-2 focus:ring-cyan-400 focus:outline-none transition-all"
          />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium text-slate-300"
            >Correo electrónico</label
          >
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="juan@empresa.com"
            class="mt-2 w-full rounded-xl bg-slate-950 px-4 py-3 text-white placeholder:text-slate-500 ring-1 ring-white/10 focus:ring-2 focus:ring-cyan-400 focus:outline-none transition-all"
          />
        </div>

        <div>
          <label for="company" class="block text-sm font-medium text-slate-300"
            >Empresa (opcional)</label
          >
          <input
            type="text"
            id="company"
            name="company"
            placeholder="Nombre de la empresa"
            class="mt-2 w-full rounded-xl bg-slate-950 px-4 py-3 text-white placeholder:text-slate-500 ring-1 ring-white/10 focus:ring-2 focus:ring-cyan-400 focus:outline-none transition-all"
          />
        </div>

        <div>
          <label for="service" class="block text-sm font-medium text-slate-300"
            >Servicio de interés</label
          >
          <select
            id="service"
            name="service"
            required
            class="mt-2 w-full rounded-xl bg-slate-950 px-4 py-3 text-white ring-1 ring-white/10 focus:ring-2 focus:ring-cyan-400 focus:outline-none transition-all"
          >
            <option value="" disabled selected>Selecciona un servicio</option>
            {servicios.map((s) => <option value={s}>{s}</option>)}
          </select>
        </div>

        <div class="sm:col-span-2">
          <label for="message" class="block text-sm font-medium text-slate-300"
            >Cuéntanos sobre tu proyecto</label
          >
          <textarea
            id="message"
            name="message"
            rows="5"
            required
            placeholder="Objetivo, alcance, tiempos estimados, etc."
            class="mt-2 w-full resize-none rounded-xl bg-slate-950 px-4 py-3 text-white placeholder:text-slate-500 ring-1 ring-white/10 focus:ring-2 focus:ring-cyan-400 focus:outline-none transition-all"
          ></textarea>
        </div>
      </div>

      <div class="mt-10 flex flex-col items-center">
        <button
          type="submit"
          id="submit-btn"
          class="group relative flex items-center gap-2 rounded-xl bg-linear-to-r from-cyan-500 to-blue-600 px-10 py-3 text-sm font-semibold text-white shadow-lg shadow-cyan-500/30 transition-all hover:shadow-cyan-500/50 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span id="btn-text">Enviar consulta</span>
          <svg
            id="spinner"
            class="hidden h-4 w-4 animate-spin text-white"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            ><circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"></circle><path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path></svg
          >
        </button>
        <p
          id="form-status"
          class="mt-4 text-center text-sm font-medium transition-all"
        >
        </p>
      </div>
    </form>
  </div>
</section>

<script>
  // Quitamos is:inline para que Astro pueda minificarlo y optimizarlo
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const status = document.getElementById("form-status");

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Validación rápida en el cliente
    const formData = new FormData(form);
    const btn = form.querySelector(
      'button[type="submit"]',
    ) as HTMLButtonElement;

    try {
      if (btn) btn.disabled = true;
      if (status) status.textContent = "Enviando...";

      const response = await fetch("http://tu-servidor-java.com/api/contacto", {
        method: "POST",
        body: formData, // O JSON.stringify(data) según prefieras en Java
      });

      const result = await response.json();

      if (result.success) {
        if (status) {
          status.textContent = "¡Correo enviado con éxito!";
          status.className =
            "mt-4 text-center text-sm font-medium text-green-400";
        }
        form.reset();
      } else {
        throw new Error(result.error || "Error desconocido");
      }
    } catch (err) {
      if (status) {
        status.textContent = "Error al enviar. Inténtalo más tarde.";
        status.className = "mt-4 text-center text-sm font-medium text-red-400";
      }
    } finally {
      if (btn) btn.disabled = false;
    }
  });
</script>
